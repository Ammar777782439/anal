
# ๐ก๏ธ ุชุญููู ูุชุตููู ุฎุฏูุฉ "Guardian"

**๐ ุงูุชุงุฑูุฎ:** 15-06-2025  
**โ๏ธ ูุงุชุจ ุงูููุงุญุธุงุช:** ุนูุงุฑ ูุงุณุฑ ุฑุงุฌุญ
**๐ ุงููุดุฑูุน:** ุฎุฏูุฉ Guardian ุงููุตุบูุฑุฉ (Microservice)

---

##  ุงูููุฏูู:

ุฎุฏูุฉ "Guardian" ุจูุจูููุง ุนูู ุดูู **ูููุฑูุณูุฑูุณ** ุชุดุชุบู ุฌูุจ ุจููุฉ ุงูุฎุฏูุงุช ูู ุงููุธุงูุ ูุชุนุชูุฏ ุนูู ุฎุฏูุฉ ุงููุตุงุฏูุฉ ุงููู ุชุนุทู ุงูุชูููุงุช.  

ุงูุฎุฏูุฉ ุจุชููุฐ 4 ููุงู ุฑุฆูุณูุฉ:

1. **ุชุณุฌูู ุงููุณุชุฎุฏููู** ุงููู ูุนูู JWT.  
2. **ุฌุฏุงุฑ ูุงุฑู** ูููุชุฑ ุฃู ุทูุจุงุช ูุดุจููุฉ.  
3. **ูุญุต ุงููููุงุช** ูู ููุฑูุณุงุช ุฃู ุชูุฏูุฏุงุช.  
4. **ุชุญุฏูุฏ ุงููููุน** (FindMe) ูููุณุชุฎุฏููู.

---

##  ุงููุทููุจุงุช (Functional & Non-Functional)

###  ูุธูููุฉ:

- FR1: ุชุณุฌูู ุจุงุณุชุฎุฏุงู JWT.  
- FR2: ููุน ุงููุฌูุงุช ูุงูุทูุจุงุช ุงูุฒุงูุฏุฉ (Firewall).  
- FR3: ุฑูุน ูููุงุช ููุญุตูุง (Scan).  
- FR4: ุชุญุฏูุซ ุงููููุน ุงูุฌุบุฑุงูู ูููุณุชุฎุฏู.  
- FR5: ุทูุจ ูููุน ูุณุชุฎุฏู ุซุงูู (ุจุดุฑูุท ุฎุตูุตูุฉ ุตุงุฑูุฉ).

###  ุบูุฑ ูุธูููุฉ:

- NFR1: ุงูุฃูุงูุ ูุณุชุฎุฏู RS256 ููุชุญูู ูู ุงูุชููู.  
- NFR2: ุงูุณุฑุนุฉุ ุฃูู ูู 200ms ููุทูุจุงุช.  
- NFR3: ูุงุจููุฉ ุงูุชูุณุน (Stateless).  
- NFR4: ุตุญุฉ ุงูุฎุฏูุฉ (/health).  
- NFR5: ุชุณุฌูู ูู ุดูุก ุจุตูุบุฉ JSON.

---

##  ุงูุชุตููู ุงููุนูุงุฑู:

```mermaid
flowchart LR
    Client[Client]
    APIGW[API Gateway]
    Guardian[Guardian Service]
    AuthService[Auth Service - JWT]
    ScanService[Scan Service]
    DB[Database]

    Client --> APIGW
    APIGW --> Guardian
    Guardian --> AuthService
    Guardian --> ScanService
    Guardian --> DB

```



```mermaid
flowchart TB
    subgraph Client_Side
        Client[Client]
    end

    subgraph Gateway
        APIGW[API Gateway]
    end

    subgraph Guardian_Service
        APILayer[API Layer]
        Middleware[Middleware Layer - Auth and Firewall]
        ServiceLogic[Service Layer]
        Repo[Repository Layer]
    end

    subgraph External_Services
        AuthService[Auth Service - JWT]
        ScanService[Scan Service]
    end

    subgraph Database
        DB[Postgres Database]
    end

    Client --> APIGW
    APIGW --> APILayer
    APILayer --> Middleware
    Middleware --> ServiceLogic
    ServiceLogic --> Repo
    Repo --> DB
    Middleware --> AuthService
    ServiceLogic --> ScanService

```



**ุทุจูุงุช ุงูููุฏ ุจูุบุฉ Go:**

- API Layer  
- Middleware Layer (Firewall + Auth)  
- Service Layer (ููุทู ุงูุชุทุจูู)  
- Repository Layer (ุงูุจูุงูุงุช)

---

##  ููููุงุช ุงูุฎุฏูุฉ:

###  Middleware:

- **Firewall:** ูููุน IPs ูุดุจููุฉ ููุญุฌุจ ุงูุณุจุงู.  
- **Auth:** ูุชุญูู ูู JWTุ ูู ูุด ุณููู ูุฑุฌุน 401.

###  ูุญุฏุฉ ุงูุชุณุฌูู:

- `POST /api/v1/register`  
- ูู ุงููุณุชุฎุฏู ูุด ููุฌูุฏ: ูุถููู.  
- ูู ููุฌูุฏ: ูุฑุฏ ุนููู ุจุฃูู ูุณุฌู.

###  ูุญุฏุฉ ุงููุญุต:

- `POST /api/v1/scan`  
- ูุณุชูุจู ุงูููู -> ูุณุฌู ุงููููุฉ -> ูุฑุฌุน job_id  
- ูุนุงูุฌู ุจุงูุฎูููุฉ -> ุงููุณุชุฎุฏู ูุชุงุจุน ุงูุญุงูุฉ ุจู job_id.

###  ูุญุฏุฉ FindMe:

- `PUT /api/v1/me/location`  
- ูุญุฏุซ ุงููููุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---

##  ูุงุนุฏุฉ ุงูุจูุงูุงุช (Postgres)

### ุฌุฏูู `profiles`

| ุงูุนููุฏ | ุงูููุน | ููุงุญุธุงุช |
|-------|-------|---------|
| id | UUID | ููุชุงุญ ุฃุณุงุณู |
| auth_service_user_id | VARCHAR | ูู ุฎุฏูุฉ ุงููุตุงุฏูุฉ |
| email | VARCHAR | ุงูุจุฑูุฏ |
| latitude | DECIMAL | ุงููููุน |
| longitude | DECIMAL | ุงููููุน |
| location_last_updated | TIMESTAMPTZ | ุขุฎุฑ ุชุญุฏูุซ |
| created_at | TIMESTAMPTZ | ููุช ุงูุชุณุฌูู |

### ุฌุฏูู `scan_jobs`

| ุงูุนููุฏ | ุงูููุน | ููุงุญุธุงุช |
|--------|--------|---------|
| id | UUID | ูุนุฑู ุงููููุฉ |
| profile_id | UUID | ุตุงุญุจ ุงูููู |
| status | VARCHAR | PENDING / COMPLETED / FAILED |
| result | VARCHAR | CLEAN / INFECTED |
| created_at | TIMESTAMPTZ | ููุช ุงูุจุฏุงูุฉ |
| completed_at | TIMESTAMPTZ | ููุช ุงูููุงูุฉ |

---

##  ูุดุงูู ูุชููุนุฉ ูุญููููุง:

-  **ุฎุฏูุฉ ุงููุตุงุฏูุฉ ููุนุชุ**  
  ูุง ุจููุจู ูุณุชุฎุฏููู ุฌุฏุฏุ ููู ุงููู ูุนูู ุชููู ุดุบุงู ููุฏุฑ ูุณุชุฎุฏู ุงูุฎุฏูุฉ.

-  **ุฎุฏูุฉ ุงููุญุต ุจุทูุฆุฉุ**  
  ูุนูุง ูุธุงู ุบูุฑ ูุชุฒุงููุ ูุงูุทูุจุงุช ุชุชุนุงูุฌ ุจุงูุฎูููุฉ.

- ๐ต **ุฎุตูุตูุฉ ุงูููุงูุนุ**  
  ูุง ูุนุฑุถ ุงููููุน ูุฃู ุดุฎุต ุฅูุง ุจุตูุงุญูุงุช ูุงุถุญุฉ. ูุงููููุน ูุดููุฑ.

---

##  ุฎูุงุตุฉ:

ูุธุงู Guardian ุฌุงูุฒ ููุงูุทูุงูุ ูุจูู ุจุฃุณุงุณ ูููุ ูุงุถุญุ ูุขูู. ูุฏุฑูุง ููุตู ุงููุธุงุฆู ุจุดูู ูุธูู ููุถูู ุณูููุฉ ูู ุงูุชุทููุฑ ูุงูุชูุณุนุฉ ูุงุญููุง.
